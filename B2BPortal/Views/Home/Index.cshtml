@using B2BPortal.Infrastructure
@using System.Security.Claims
@{ 
    string Email="", FirstName="", LastName="";
    bool PreAuthed = false;
    //pick up the form pre-fills - if the user has PreAuthed via the multi-tenant app
    if (User.Identity.IsAuthenticated && (Utils.GetClaim(CustomClaimTypes.TenantId) != Settings.TenantID))
    {
        Email = (Utils.GetClaim(ClaimTypes.Email)) == null ? Utils.GetClaim(ClaimTypes.Name) : Utils.GetClaim(ClaimTypes.Email);
        FirstName = Utils.GetClaim(ClaimTypes.GivenName);
        LastName = Utils.GetClaim(ClaimTypes.Surname);
        PreAuthed = true;
    }
}
<h2>@ViewBag.Title</h2>

@using (Html.BeginForm("SignUp", "Profile", FormMethod.Post))
{
    <input type="hidden" name="PreAuthed" value="@PreAuthed.ToString().ToLower()" />

    <div class="form-group">
        <label for="EmailAddress">
            Email Address
        </label>
        <input class="form-control" type="text" value="@Email" id="EmailAddress" name="EmailAddress" placeholder="Email">
    </div>
    <div class="form-group">
        <label for="FirstName">
            First Name
        </label>
        <input class="form-control" value="@FirstName" type="text" id="FirstName" name="FirstName" placeholder="First Name">
    </div>
    <div class="form-group">
        <label for="LastName">
            Last Name
        </label>
        <input class="form-control" value="@LastName" type="text" id="LastName" name="LastName" placeholder="Last Name">
    </div>
    if (PreAuthed)
    {
        <div class="form-group">
            <label for="PreAuthed">
                Pre-Authenticated
            </label>
            <img src="~/Content/images/CheckYes.png" />
        </div>
    }
    <div class="form-group buttons">
        <button class="btn btn-primary btn-default" type="submit">Request Access</button>
        @if (!PreAuthed)
        {
        <button class="btn btn-default" id="btnPreAuth" type="button">Pre-Auth *</button>
        <p>
            *Pre-Auth: Click this button to login with your existing work credentials.
        </p>
        }
    </div>
}
@section styles {
    <style type="text/css">
        div.buttons button {
            width:150px;
            margin:10px;
        }
    </style>    
}
@section scripts {
<script type="text/javascript">
    $(function () {
        $("#btnPreAuth").on("click", function () {
            location.href='/Account/SignInWorkMulti';
            return false;
        });
    });
</script>
}
